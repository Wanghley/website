{"ast":null,"code":"\"use client\";\n\nimport { peek, listenEvent, effect, DOMEvent, isString, camelToKebabCase, isUndefined, isFunction } from './vidstack-CH225ns1.js';\nimport { QualitySymbol, RAFLoop, TextTrack, TextTrackSymbol, ListSymbol, IS_CHROME, coerceToError, loadScript, VideoProvider, isHLSSupported, preconnect } from './vidstack-C-WrcxmD.js';\nimport 'react';\nimport '@floating-ui/dom';\nconst toDOMEventType = type => camelToKebabCase(type);\nclass HLSController {\n  #video;\n  #ctx;\n  #instance = null;\n  #stopLiveSync = null;\n  config = {};\n  #callbacks = /* @__PURE__ */new Set();\n  get instance() {\n    return this.#instance;\n  }\n  constructor(video, ctx) {\n    this.#video = video;\n    this.#ctx = ctx;\n  }\n  setup(ctor) {\n    const {\n      streamType\n    } = this.#ctx.$state;\n    const isLive = peek(streamType).includes(\"live\"),\n      isLiveLowLatency = peek(streamType).includes(\"ll-\");\n    this.#instance = new ctor({\n      lowLatencyMode: isLiveLowLatency,\n      backBufferLength: isLiveLowLatency ? 4 : isLive ? 8 : void 0,\n      renderTextTracksNatively: false,\n      ...this.config\n    });\n    const dispatcher = this.#dispatchHLSEvent.bind(this);\n    for (const event of Object.values(ctor.Events)) this.#instance.on(event, dispatcher);\n    this.#instance.on(ctor.Events.ERROR, this.#onError.bind(this));\n    for (const callback of this.#callbacks) callback(this.#instance);\n    this.#ctx.player.dispatch(\"hls-instance\", {\n      detail: this.#instance\n    });\n    this.#instance.attachMedia(this.#video);\n    this.#instance.on(ctor.Events.AUDIO_TRACK_SWITCHED, this.#onAudioSwitch.bind(this));\n    this.#instance.on(ctor.Events.LEVEL_SWITCHED, this.#onLevelSwitched.bind(this));\n    this.#instance.on(ctor.Events.LEVEL_LOADED, this.#onLevelLoaded.bind(this));\n    this.#instance.on(ctor.Events.LEVEL_UPDATED, this.#onLevelUpdated.bind(this));\n    this.#instance.on(ctor.Events.NON_NATIVE_TEXT_TRACKS_FOUND, this.#onTracksFound.bind(this));\n    this.#instance.on(ctor.Events.CUES_PARSED, this.#onCuesParsed.bind(this));\n    this.#ctx.qualities[QualitySymbol.enableAuto] = this.#enableAutoQuality.bind(this);\n    listenEvent(this.#ctx.qualities, \"change\", this.#onUserQualityChange.bind(this));\n    listenEvent(this.#ctx.audioTracks, \"change\", this.#onUserAudioChange.bind(this));\n    this.#stopLiveSync = effect(this.#liveSync.bind(this));\n  }\n  #createDOMEvent(type, data) {\n    return new DOMEvent(toDOMEventType(type), {\n      detail: data\n    });\n  }\n  #liveSync() {\n    if (!this.#ctx.$state.live()) return;\n    const raf = new RAFLoop(this.#liveSyncPosition.bind(this));\n    raf.start();\n    return raf.stop.bind(raf);\n  }\n  #liveSyncPosition() {\n    this.#ctx.$state.liveSyncPosition.set(this.#instance?.liveSyncPosition ?? Infinity);\n  }\n  #dispatchHLSEvent(type, data) {\n    this.#ctx.player?.dispatch(this.#createDOMEvent(type, data));\n  }\n  #onTracksFound(eventType, data) {\n    const event = this.#createDOMEvent(eventType, data);\n    let currentTrack = -1;\n    for (let i = 0; i < data.tracks.length; i++) {\n      const nonNativeTrack = data.tracks[i],\n        init = nonNativeTrack.subtitleTrack ?? nonNativeTrack.closedCaptions,\n        track = new TextTrack({\n          id: `hls-${nonNativeTrack.kind}-${i}`,\n          src: init?.url,\n          label: nonNativeTrack.label,\n          language: init?.lang,\n          kind: nonNativeTrack.kind,\n          default: nonNativeTrack.default\n        });\n      track[TextTrackSymbol.readyState] = 2;\n      track[TextTrackSymbol.onModeChange] = () => {\n        if (track.mode === \"showing\") {\n          this.#instance.subtitleTrack = i;\n          currentTrack = i;\n        } else if (currentTrack === i) {\n          this.#instance.subtitleTrack = -1;\n          currentTrack = -1;\n        }\n      };\n      this.#ctx.textTracks.add(track, event);\n    }\n  }\n  #onCuesParsed(eventType, data) {\n    const index = this.#instance?.subtitleTrack,\n      track = this.#ctx.textTracks.getById(`hls-${data.type}-${index}`);\n    if (!track) return;\n    const event = this.#createDOMEvent(eventType, data);\n    for (const cue of data.cues) {\n      cue.positionAlign = \"auto\";\n      track.addCue(cue, event);\n    }\n  }\n  #onAudioSwitch(eventType, data) {\n    const track = this.#ctx.audioTracks[data.id];\n    if (track) {\n      const trigger = this.#createDOMEvent(eventType, data);\n      this.#ctx.audioTracks[ListSymbol.select](track, true, trigger);\n    }\n  }\n  #onLevelSwitched(eventType, data) {\n    const quality = this.#ctx.qualities[data.level];\n    if (quality) {\n      const trigger = this.#createDOMEvent(eventType, data);\n      this.#ctx.qualities[ListSymbol.select](quality, true, trigger);\n    }\n  }\n  #onLevelUpdated(eventType, data) {\n    if (data.details.totalduration > 0) {\n      this.#ctx.$state.inferredLiveDVRWindow.set(data.details.totalduration);\n    }\n  }\n  #onLevelLoaded(eventType, data) {\n    if (this.#ctx.$state.canPlay()) return;\n    const {\n        type,\n        live,\n        totalduration: duration,\n        targetduration\n      } = data.details,\n      trigger = this.#createDOMEvent(eventType, data);\n    this.#ctx.notify(\"stream-type-change\", live ? type === \"EVENT\" && Number.isFinite(duration) && targetduration >= 10 ? \"live:dvr\" : \"live\" : \"on-demand\", trigger);\n    this.#ctx.notify(\"duration-change\", duration, trigger);\n    const media = this.#instance.media;\n    if (this.#instance.currentLevel === -1) {\n      this.#ctx.qualities[QualitySymbol.setAuto](true, trigger);\n    }\n    for (const remoteTrack of this.#instance.audioTracks) {\n      const localTrack = {\n        id: remoteTrack.id.toString(),\n        label: remoteTrack.name,\n        language: remoteTrack.lang || \"\",\n        kind: \"main\"\n      };\n      this.#ctx.audioTracks[ListSymbol.add](localTrack, trigger);\n    }\n    for (const level of this.#instance.levels) {\n      const videoQuality = {\n        id: level.id?.toString() ?? level.height + \"p\",\n        width: level.width,\n        height: level.height,\n        codec: level.codecSet,\n        bitrate: level.bitrate\n      };\n      this.#ctx.qualities[ListSymbol.add](videoQuality, trigger);\n    }\n    media.dispatchEvent(new DOMEvent(\"canplay\", {\n      trigger\n    }));\n  }\n  #onError(eventType, data) {\n    {\n      this.#ctx.logger?.errorGroup(`[vidstack] HLS error \\`${eventType}\\``).labelledLog(\"Media Element\", this.#instance?.media).labelledLog(\"HLS Instance\", this.#instance).labelledLog(\"Event Type\", eventType).labelledLog(\"Data\", data).labelledLog(\"Src\", peek(this.#ctx.$state.source)).labelledLog(\"Media Store\", {\n        ...this.#ctx.$state\n      }).dispatch();\n    }\n    if (data.fatal) {\n      switch (data.type) {\n        case \"mediaError\":\n          this.#instance?.recoverMediaError();\n          break;\n        default:\n          this.#onFatalError(data.error);\n          break;\n      }\n    }\n  }\n  #onFatalError(error) {\n    this.#ctx.notify(\"error\", {\n      message: error.message,\n      code: 1,\n      error\n    });\n  }\n  #enableAutoQuality() {\n    if (this.#instance) this.#instance.currentLevel = -1;\n  }\n  #onUserQualityChange() {\n    const {\n      qualities\n    } = this.#ctx;\n    if (!this.#instance || qualities.auto) return;\n    this.#instance[qualities.switch + \"Level\"] = qualities.selectedIndex;\n    if (IS_CHROME) {\n      this.#video.currentTime = this.#video.currentTime;\n    }\n  }\n  #onUserAudioChange() {\n    const {\n      audioTracks\n    } = this.#ctx;\n    if (this.#instance && this.#instance.audioTrack !== audioTracks.selectedIndex) {\n      this.#instance.audioTrack = audioTracks.selectedIndex;\n    }\n  }\n  onInstance(callback) {\n    this.#callbacks.add(callback);\n    return () => this.#callbacks.delete(callback);\n  }\n  loadSource(src) {\n    if (!isString(src.src)) return;\n    this.#instance?.loadSource(src.src);\n  }\n  destroy() {\n    this.#instance?.destroy();\n    this.#instance = null;\n    this.#stopLiveSync?.();\n    this.#stopLiveSync = null;\n    this.#ctx?.logger?.info(\"\\u{1F3D7}\\uFE0F Destroyed HLS instance\");\n  }\n}\nclass HLSLibLoader {\n  #lib;\n  #ctx;\n  #callback;\n  constructor(lib, ctx, callback) {\n    this.#lib = lib;\n    this.#ctx = ctx;\n    this.#callback = callback;\n    this.#startLoading();\n  }\n  async #startLoading() {\n    this.#ctx.logger?.info(\"\\u{1F3D7}\\uFE0F Loading HLS Library\");\n    const callbacks = {\n      onLoadStart: this.#onLoadStart.bind(this),\n      onLoaded: this.#onLoaded.bind(this),\n      onLoadError: this.#onLoadError.bind(this)\n    };\n    let ctor = await loadHLSScript(this.#lib, callbacks);\n    if (isUndefined(ctor) && !isString(this.#lib)) ctor = await importHLS(this.#lib, callbacks);\n    if (!ctor) return null;\n    if (!ctor.isSupported()) {\n      const message = \"[vidstack] `hls.js` is not supported in this environment\";\n      this.#ctx.logger?.error(message);\n      this.#ctx.player.dispatch(new DOMEvent(\"hls-unsupported\"));\n      this.#ctx.notify(\"error\", {\n        message,\n        code: 4\n      });\n      return null;\n    }\n    return ctor;\n  }\n  #onLoadStart() {\n    {\n      this.#ctx.logger?.infoGroup(\"Starting to load `hls.js`\").labelledLog(\"URL\", this.#lib).dispatch();\n    }\n    this.#ctx.player.dispatch(new DOMEvent(\"hls-lib-load-start\"));\n  }\n  #onLoaded(ctor) {\n    {\n      this.#ctx.logger?.infoGroup(\"Loaded `hls.js`\").labelledLog(\"Library\", this.#lib).labelledLog(\"Constructor\", ctor).dispatch();\n    }\n    this.#ctx.player.dispatch(new DOMEvent(\"hls-lib-loaded\", {\n      detail: ctor\n    }));\n    this.#callback(ctor);\n  }\n  #onLoadError(e) {\n    const error = coerceToError(e);\n    {\n      this.#ctx.logger?.errorGroup(\"[vidstack] Failed to load `hls.js`\").labelledLog(\"Library\", this.#lib).labelledLog(\"Error\", e).dispatch();\n    }\n    this.#ctx.player.dispatch(new DOMEvent(\"hls-lib-load-error\", {\n      detail: error\n    }));\n    this.#ctx.notify(\"error\", {\n      message: error.message,\n      code: 4,\n      error\n    });\n  }\n}\nasync function importHLS(loader, callbacks = {}) {\n  if (isUndefined(loader)) return void 0;\n  callbacks.onLoadStart?.();\n  if (loader.prototype && loader.prototype !== Function) {\n    callbacks.onLoaded?.(loader);\n    return loader;\n  }\n  try {\n    const ctor = (await loader())?.default;\n    if (ctor && !!ctor.isSupported) {\n      callbacks.onLoaded?.(ctor);\n    } else {\n      throw Error(true ? \"[vidstack] failed importing `hls.js`. Dynamic import returned invalid constructor.\" : \"\");\n    }\n    return ctor;\n  } catch (err) {\n    callbacks.onLoadError?.(err);\n  }\n  return void 0;\n}\nasync function loadHLSScript(src, callbacks = {}) {\n  if (!isString(src)) return void 0;\n  callbacks.onLoadStart?.();\n  try {\n    await loadScript(src);\n    if (!isFunction(window.Hls)) {\n      throw Error(true ? \"[vidstack] failed loading `hls.js`. Could not find a valid `Hls` constructor on window\" : \"\");\n    }\n    const ctor = window.Hls;\n    callbacks.onLoaded?.(ctor);\n    return ctor;\n  } catch (err) {\n    callbacks.onLoadError?.(err);\n  }\n  return void 0;\n}\nconst JS_DELIVR_CDN = \"https://cdn.jsdelivr.net\";\nclass HLSProvider extends VideoProvider {\n  $$PROVIDER_TYPE = \"HLS\";\n  #ctor = null;\n  #controller = new HLSController(this.video, this.ctx);\n  /**\n   * The `hls.js` constructor.\n   */\n  get ctor() {\n    return this.#ctor;\n  }\n  /**\n   * The current `hls.js` instance.\n   */\n  get instance() {\n    return this.#controller.instance;\n  }\n  /**\n   * Whether `hls.js` is supported in this environment.\n   */\n  static supported = isHLSSupported();\n  get type() {\n    return \"hls\";\n  }\n  get canLiveSync() {\n    return true;\n  }\n  #library = `${JS_DELIVR_CDN}/npm/hls.js@^1.5.0/dist/hls${\".js\"}`;\n  /**\n   * The `hls.js` configuration object.\n   *\n   * @see {@link https://github.com/video-dev/hls.js/blob/master/docs/API.md#fine-tuning}\n   */\n  get config() {\n    return this.#controller.config;\n  }\n  set config(config) {\n    this.#controller.config = config;\n  }\n  /**\n   * The `hls.js` constructor (supports dynamic imports) or a URL of where it can be found.\n   *\n   * @defaultValue `https://cdn.jsdelivr.net/npm/hls.js@^1.0.0/dist/hls.min.js`\n   */\n  get library() {\n    return this.#library;\n  }\n  set library(library) {\n    this.#library = library;\n  }\n  preconnect() {\n    if (!isString(this.#library)) return;\n    preconnect(this.#library);\n  }\n  setup() {\n    super.setup();\n    new HLSLibLoader(this.#library, this.ctx, ctor => {\n      this.#ctor = ctor;\n      this.#controller.setup(ctor);\n      this.ctx.notify(\"provider-setup\", this);\n      const src = peek(this.ctx.$state.source);\n      if (src) this.loadSource(src);\n    });\n  }\n  async loadSource(src, preload) {\n    if (!isString(src.src)) {\n      this.removeSource();\n      return;\n    }\n    this.media.preload = preload || \"\";\n    this.appendSource(src, \"application/x-mpegurl\");\n    this.#controller.loadSource(src);\n    this.currentSrc = src;\n  }\n  /**\n   * The given callback is invoked when a new `hls.js` instance is created and right before it's\n   * attached to media.\n   */\n  onInstance(callback) {\n    const instance = this.#controller.instance;\n    if (instance) callback(instance);\n    return this.#controller.onInstance(callback);\n  }\n  destroy() {\n    this.#controller.destroy();\n  }\n}\nexport { HLSProvider };","map":{"version":3,"names":["peek","listenEvent","effect","DOMEvent","isString","camelToKebabCase","isUndefined","isFunction","QualitySymbol","RAFLoop","TextTrack","TextTrackSymbol","ListSymbol","IS_CHROME","coerceToError","loadScript","VideoProvider","isHLSSupported","preconnect","toDOMEventType","type","HLSController","video","ctx","instance","stopLiveSync","config","callbacks","Set","constructor","setup","ctor","streamType","$state","isLive","includes","isLiveLowLatency","lowLatencyMode","backBufferLength","renderTextTracksNatively","dispatcher","dispatchHLSEvent","bind","event","Object","values","Events","on","ERROR","onError","callback","player","dispatch","detail","attachMedia","AUDIO_TRACK_SWITCHED","onAudioSwitch","LEVEL_SWITCHED","onLevelSwitched","LEVEL_LOADED","onLevelLoaded","LEVEL_UPDATED","onLevelUpdated","NON_NATIVE_TEXT_TRACKS_FOUND","onTracksFound","CUES_PARSED","onCuesParsed","qualities","enableAuto","enableAutoQuality","onUserQualityChange","audioTracks","onUserAudioChange","liveSync","createDOMEvent","#createDOMEvent","data","#liveSync","live","raf","liveSyncPosition","start","stop","#liveSyncPosition","set","Infinity","#dispatchHLSEvent","#onTracksFound","eventType","currentTrack","i","tracks","length","nonNativeTrack","init","subtitleTrack","closedCaptions","track","id","kind","src","url","label","language","lang","default","readyState","onModeChange","mode","textTracks","add","#onCuesParsed","index","getById","cue","cues","positionAlign","addCue","#onAudioSwitch","trigger","select","#onLevelSwitched","quality","level","#onLevelUpdated","details","totalduration","inferredLiveDVRWindow","#onLevelLoaded","canPlay","duration","targetduration","notify","Number","isFinite","media","currentLevel","setAuto","remoteTrack","localTrack","toString","name","levels","videoQuality","height","width","codec","codecSet","bitrate","dispatchEvent","#onError","logger","errorGroup","labelledLog","source","fatal","recoverMediaError","onFatalError","error","#onFatalError","message","code","#enableAutoQuality","#onUserQualityChange","auto","switch","selectedIndex","currentTime","#onUserAudioChange","audioTrack","onInstance","delete","loadSource","destroy","info","HLSLibLoader","lib","startLoading","#startLoading","onLoadStart","onLoaded","onLoadError","loadHLSScript","importHLS","isSupported","#onLoadStart","infoGroup","#onLoaded","#onLoadError","e","loader","prototype","Function","Error","err","window","Hls","JS_DELIVR_CDN","HLSProvider","$$PROVIDER_TYPE","controller","supported","canLiveSync","library","preload","removeSource","appendSource","currentSrc"],"sources":["/Users/wanghley/Workspace/Projects/wanghley.com/node_modules/@vidstack/react/dev/chunks/vidstack-GNfRj3wa.js"],"sourcesContent":["\"use client\"\n\nimport { peek, listenEvent, effect, DOMEvent, isString, camelToKebabCase, isUndefined, isFunction } from './vidstack-CH225ns1.js';\nimport { QualitySymbol, RAFLoop, TextTrack, TextTrackSymbol, ListSymbol, IS_CHROME, coerceToError, loadScript, VideoProvider, isHLSSupported, preconnect } from './vidstack-C-WrcxmD.js';\nimport 'react';\nimport '@floating-ui/dom';\n\nconst toDOMEventType = (type) => camelToKebabCase(type);\nclass HLSController {\n  #video;\n  #ctx;\n  #instance = null;\n  #stopLiveSync = null;\n  config = {};\n  #callbacks = /* @__PURE__ */ new Set();\n  get instance() {\n    return this.#instance;\n  }\n  constructor(video, ctx) {\n    this.#video = video;\n    this.#ctx = ctx;\n  }\n  setup(ctor) {\n    const { streamType } = this.#ctx.$state;\n    const isLive = peek(streamType).includes(\"live\"), isLiveLowLatency = peek(streamType).includes(\"ll-\");\n    this.#instance = new ctor({\n      lowLatencyMode: isLiveLowLatency,\n      backBufferLength: isLiveLowLatency ? 4 : isLive ? 8 : void 0,\n      renderTextTracksNatively: false,\n      ...this.config\n    });\n    const dispatcher = this.#dispatchHLSEvent.bind(this);\n    for (const event of Object.values(ctor.Events)) this.#instance.on(event, dispatcher);\n    this.#instance.on(ctor.Events.ERROR, this.#onError.bind(this));\n    for (const callback of this.#callbacks) callback(this.#instance);\n    this.#ctx.player.dispatch(\"hls-instance\", {\n      detail: this.#instance\n    });\n    this.#instance.attachMedia(this.#video);\n    this.#instance.on(ctor.Events.AUDIO_TRACK_SWITCHED, this.#onAudioSwitch.bind(this));\n    this.#instance.on(ctor.Events.LEVEL_SWITCHED, this.#onLevelSwitched.bind(this));\n    this.#instance.on(ctor.Events.LEVEL_LOADED, this.#onLevelLoaded.bind(this));\n    this.#instance.on(ctor.Events.LEVEL_UPDATED, this.#onLevelUpdated.bind(this));\n    this.#instance.on(ctor.Events.NON_NATIVE_TEXT_TRACKS_FOUND, this.#onTracksFound.bind(this));\n    this.#instance.on(ctor.Events.CUES_PARSED, this.#onCuesParsed.bind(this));\n    this.#ctx.qualities[QualitySymbol.enableAuto] = this.#enableAutoQuality.bind(this);\n    listenEvent(this.#ctx.qualities, \"change\", this.#onUserQualityChange.bind(this));\n    listenEvent(this.#ctx.audioTracks, \"change\", this.#onUserAudioChange.bind(this));\n    this.#stopLiveSync = effect(this.#liveSync.bind(this));\n  }\n  #createDOMEvent(type, data) {\n    return new DOMEvent(toDOMEventType(type), { detail: data });\n  }\n  #liveSync() {\n    if (!this.#ctx.$state.live()) return;\n    const raf = new RAFLoop(this.#liveSyncPosition.bind(this));\n    raf.start();\n    return raf.stop.bind(raf);\n  }\n  #liveSyncPosition() {\n    this.#ctx.$state.liveSyncPosition.set(this.#instance?.liveSyncPosition ?? Infinity);\n  }\n  #dispatchHLSEvent(type, data) {\n    this.#ctx.player?.dispatch(this.#createDOMEvent(type, data));\n  }\n  #onTracksFound(eventType, data) {\n    const event = this.#createDOMEvent(eventType, data);\n    let currentTrack = -1;\n    for (let i = 0; i < data.tracks.length; i++) {\n      const nonNativeTrack = data.tracks[i], init = nonNativeTrack.subtitleTrack ?? nonNativeTrack.closedCaptions, track = new TextTrack({\n        id: `hls-${nonNativeTrack.kind}-${i}`,\n        src: init?.url,\n        label: nonNativeTrack.label,\n        language: init?.lang,\n        kind: nonNativeTrack.kind,\n        default: nonNativeTrack.default\n      });\n      track[TextTrackSymbol.readyState] = 2;\n      track[TextTrackSymbol.onModeChange] = () => {\n        if (track.mode === \"showing\") {\n          this.#instance.subtitleTrack = i;\n          currentTrack = i;\n        } else if (currentTrack === i) {\n          this.#instance.subtitleTrack = -1;\n          currentTrack = -1;\n        }\n      };\n      this.#ctx.textTracks.add(track, event);\n    }\n  }\n  #onCuesParsed(eventType, data) {\n    const index = this.#instance?.subtitleTrack, track = this.#ctx.textTracks.getById(`hls-${data.type}-${index}`);\n    if (!track) return;\n    const event = this.#createDOMEvent(eventType, data);\n    for (const cue of data.cues) {\n      cue.positionAlign = \"auto\";\n      track.addCue(cue, event);\n    }\n  }\n  #onAudioSwitch(eventType, data) {\n    const track = this.#ctx.audioTracks[data.id];\n    if (track) {\n      const trigger = this.#createDOMEvent(eventType, data);\n      this.#ctx.audioTracks[ListSymbol.select](track, true, trigger);\n    }\n  }\n  #onLevelSwitched(eventType, data) {\n    const quality = this.#ctx.qualities[data.level];\n    if (quality) {\n      const trigger = this.#createDOMEvent(eventType, data);\n      this.#ctx.qualities[ListSymbol.select](quality, true, trigger);\n    }\n  }\n  #onLevelUpdated(eventType, data) {\n    if (data.details.totalduration > 0) {\n      this.#ctx.$state.inferredLiveDVRWindow.set(data.details.totalduration);\n    }\n  }\n  #onLevelLoaded(eventType, data) {\n    if (this.#ctx.$state.canPlay()) return;\n    const { type, live, totalduration: duration, targetduration } = data.details, trigger = this.#createDOMEvent(eventType, data);\n    this.#ctx.notify(\n      \"stream-type-change\",\n      live ? type === \"EVENT\" && Number.isFinite(duration) && targetduration >= 10 ? \"live:dvr\" : \"live\" : \"on-demand\",\n      trigger\n    );\n    this.#ctx.notify(\"duration-change\", duration, trigger);\n    const media = this.#instance.media;\n    if (this.#instance.currentLevel === -1) {\n      this.#ctx.qualities[QualitySymbol.setAuto](true, trigger);\n    }\n    for (const remoteTrack of this.#instance.audioTracks) {\n      const localTrack = {\n        id: remoteTrack.id.toString(),\n        label: remoteTrack.name,\n        language: remoteTrack.lang || \"\",\n        kind: \"main\"\n      };\n      this.#ctx.audioTracks[ListSymbol.add](localTrack, trigger);\n    }\n    for (const level of this.#instance.levels) {\n      const videoQuality = {\n        id: level.id?.toString() ?? level.height + \"p\",\n        width: level.width,\n        height: level.height,\n        codec: level.codecSet,\n        bitrate: level.bitrate\n      };\n      this.#ctx.qualities[ListSymbol.add](videoQuality, trigger);\n    }\n    media.dispatchEvent(new DOMEvent(\"canplay\", { trigger }));\n  }\n  #onError(eventType, data) {\n    {\n      this.#ctx.logger?.errorGroup(`[vidstack] HLS error \\`${eventType}\\``).labelledLog(\"Media Element\", this.#instance?.media).labelledLog(\"HLS Instance\", this.#instance).labelledLog(\"Event Type\", eventType).labelledLog(\"Data\", data).labelledLog(\"Src\", peek(this.#ctx.$state.source)).labelledLog(\"Media Store\", { ...this.#ctx.$state }).dispatch();\n    }\n    if (data.fatal) {\n      switch (data.type) {\n        case \"mediaError\":\n          this.#instance?.recoverMediaError();\n          break;\n        default:\n          this.#onFatalError(data.error);\n          break;\n      }\n    }\n  }\n  #onFatalError(error) {\n    this.#ctx.notify(\"error\", {\n      message: error.message,\n      code: 1,\n      error\n    });\n  }\n  #enableAutoQuality() {\n    if (this.#instance) this.#instance.currentLevel = -1;\n  }\n  #onUserQualityChange() {\n    const { qualities } = this.#ctx;\n    if (!this.#instance || qualities.auto) return;\n    this.#instance[qualities.switch + \"Level\"] = qualities.selectedIndex;\n    if (IS_CHROME) {\n      this.#video.currentTime = this.#video.currentTime;\n    }\n  }\n  #onUserAudioChange() {\n    const { audioTracks } = this.#ctx;\n    if (this.#instance && this.#instance.audioTrack !== audioTracks.selectedIndex) {\n      this.#instance.audioTrack = audioTracks.selectedIndex;\n    }\n  }\n  onInstance(callback) {\n    this.#callbacks.add(callback);\n    return () => this.#callbacks.delete(callback);\n  }\n  loadSource(src) {\n    if (!isString(src.src)) return;\n    this.#instance?.loadSource(src.src);\n  }\n  destroy() {\n    this.#instance?.destroy();\n    this.#instance = null;\n    this.#stopLiveSync?.();\n    this.#stopLiveSync = null;\n    this.#ctx?.logger?.info(\"\\u{1F3D7}\\uFE0F Destroyed HLS instance\");\n  }\n}\n\nclass HLSLibLoader {\n  #lib;\n  #ctx;\n  #callback;\n  constructor(lib, ctx, callback) {\n    this.#lib = lib;\n    this.#ctx = ctx;\n    this.#callback = callback;\n    this.#startLoading();\n  }\n  async #startLoading() {\n    this.#ctx.logger?.info(\"\\u{1F3D7}\\uFE0F Loading HLS Library\");\n    const callbacks = {\n      onLoadStart: this.#onLoadStart.bind(this),\n      onLoaded: this.#onLoaded.bind(this),\n      onLoadError: this.#onLoadError.bind(this)\n    };\n    let ctor = await loadHLSScript(this.#lib, callbacks);\n    if (isUndefined(ctor) && !isString(this.#lib)) ctor = await importHLS(this.#lib, callbacks);\n    if (!ctor) return null;\n    if (!ctor.isSupported()) {\n      const message = \"[vidstack] `hls.js` is not supported in this environment\";\n      this.#ctx.logger?.error(message);\n      this.#ctx.player.dispatch(new DOMEvent(\"hls-unsupported\"));\n      this.#ctx.notify(\"error\", { message, code: 4 });\n      return null;\n    }\n    return ctor;\n  }\n  #onLoadStart() {\n    {\n      this.#ctx.logger?.infoGroup(\"Starting to load `hls.js`\").labelledLog(\"URL\", this.#lib).dispatch();\n    }\n    this.#ctx.player.dispatch(new DOMEvent(\"hls-lib-load-start\"));\n  }\n  #onLoaded(ctor) {\n    {\n      this.#ctx.logger?.infoGroup(\"Loaded `hls.js`\").labelledLog(\"Library\", this.#lib).labelledLog(\"Constructor\", ctor).dispatch();\n    }\n    this.#ctx.player.dispatch(\n      new DOMEvent(\"hls-lib-loaded\", {\n        detail: ctor\n      })\n    );\n    this.#callback(ctor);\n  }\n  #onLoadError(e) {\n    const error = coerceToError(e);\n    {\n      this.#ctx.logger?.errorGroup(\"[vidstack] Failed to load `hls.js`\").labelledLog(\"Library\", this.#lib).labelledLog(\"Error\", e).dispatch();\n    }\n    this.#ctx.player.dispatch(\n      new DOMEvent(\"hls-lib-load-error\", {\n        detail: error\n      })\n    );\n    this.#ctx.notify(\"error\", {\n      message: error.message,\n      code: 4,\n      error\n    });\n  }\n}\nasync function importHLS(loader, callbacks = {}) {\n  if (isUndefined(loader)) return void 0;\n  callbacks.onLoadStart?.();\n  if (loader.prototype && loader.prototype !== Function) {\n    callbacks.onLoaded?.(loader);\n    return loader;\n  }\n  try {\n    const ctor = (await loader())?.default;\n    if (ctor && !!ctor.isSupported) {\n      callbacks.onLoaded?.(ctor);\n    } else {\n      throw Error(\n        true ? \"[vidstack] failed importing `hls.js`. Dynamic import returned invalid constructor.\" : \"\"\n      );\n    }\n    return ctor;\n  } catch (err) {\n    callbacks.onLoadError?.(err);\n  }\n  return void 0;\n}\nasync function loadHLSScript(src, callbacks = {}) {\n  if (!isString(src)) return void 0;\n  callbacks.onLoadStart?.();\n  try {\n    await loadScript(src);\n    if (!isFunction(window.Hls)) {\n      throw Error(\n        true ? \"[vidstack] failed loading `hls.js`. Could not find a valid `Hls` constructor on window\" : \"\"\n      );\n    }\n    const ctor = window.Hls;\n    callbacks.onLoaded?.(ctor);\n    return ctor;\n  } catch (err) {\n    callbacks.onLoadError?.(err);\n  }\n  return void 0;\n}\n\nconst JS_DELIVR_CDN = \"https://cdn.jsdelivr.net\";\nclass HLSProvider extends VideoProvider {\n  $$PROVIDER_TYPE = \"HLS\";\n  #ctor = null;\n  #controller = new HLSController(this.video, this.ctx);\n  /**\n   * The `hls.js` constructor.\n   */\n  get ctor() {\n    return this.#ctor;\n  }\n  /**\n   * The current `hls.js` instance.\n   */\n  get instance() {\n    return this.#controller.instance;\n  }\n  /**\n   * Whether `hls.js` is supported in this environment.\n   */\n  static supported = isHLSSupported();\n  get type() {\n    return \"hls\";\n  }\n  get canLiveSync() {\n    return true;\n  }\n  #library = `${JS_DELIVR_CDN}/npm/hls.js@^1.5.0/dist/hls${\".js\" }`;\n  /**\n   * The `hls.js` configuration object.\n   *\n   * @see {@link https://github.com/video-dev/hls.js/blob/master/docs/API.md#fine-tuning}\n   */\n  get config() {\n    return this.#controller.config;\n  }\n  set config(config) {\n    this.#controller.config = config;\n  }\n  /**\n   * The `hls.js` constructor (supports dynamic imports) or a URL of where it can be found.\n   *\n   * @defaultValue `https://cdn.jsdelivr.net/npm/hls.js@^1.0.0/dist/hls.min.js`\n   */\n  get library() {\n    return this.#library;\n  }\n  set library(library) {\n    this.#library = library;\n  }\n  preconnect() {\n    if (!isString(this.#library)) return;\n    preconnect(this.#library);\n  }\n  setup() {\n    super.setup();\n    new HLSLibLoader(this.#library, this.ctx, (ctor) => {\n      this.#ctor = ctor;\n      this.#controller.setup(ctor);\n      this.ctx.notify(\"provider-setup\", this);\n      const src = peek(this.ctx.$state.source);\n      if (src) this.loadSource(src);\n    });\n  }\n  async loadSource(src, preload) {\n    if (!isString(src.src)) {\n      this.removeSource();\n      return;\n    }\n    this.media.preload = preload || \"\";\n    this.appendSource(src, \"application/x-mpegurl\");\n    this.#controller.loadSource(src);\n    this.currentSrc = src;\n  }\n  /**\n   * The given callback is invoked when a new `hls.js` instance is created and right before it's\n   * attached to media.\n   */\n  onInstance(callback) {\n    const instance = this.#controller.instance;\n    if (instance) callback(instance);\n    return this.#controller.onInstance(callback);\n  }\n  destroy() {\n    this.#controller.destroy();\n  }\n}\n\nexport { HLSProvider };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}